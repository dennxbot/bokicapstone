import{u as z,r as d,j as e}from"./index-rA_UgCij.js";import{u as L,s as f}from"./useAuth-CjWk1XML.js";import{B}from"./Button-CaIT6pSL.js";import{f as $}from"./currency-XAUvB6j1.js";import{A as U}from"./AdminSidebar-CLXZbcRD.js";import{n as m}from"./notifications-CinQkvF9.js";const Y=()=>{const o=z(),{user:n,isLoading:h,isAuthenticated:g,isAdmin:u}=L(),[x,k]=d.useState({totalOrders:0,pendingOrders:0,totalRevenue:0,totalMenuItems:0,todayOrders:0,todaySales:0,completedOrders:0}),[N,A]=d.useState([]),[i,p]=d.useState([]),[b,y]=d.useState(!1),[C,v]=d.useState(!0);d.useEffect(()=>{if(!h){if(!g||!u){o("/login");return}M(),j()}},[g,u,h,o]);const M=()=>{const s=f.channel("admin-order-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},async a=>{const r=a.new;m.isEnabled()&&await m.showNewOrderNotification({orderId:r.id,customerName:r.customer_name,totalAmount:parseFloat(r.total_amount),orderType:r.order_type}),j()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},async a=>{const r=a.new,l=a.old;m.isEnabled()&&r.status!==l.status&&l.status!=="pending"&&await m.showOrderUpdateNotification({orderId:r.id,customerName:r.customer_name,status:r.status,previousStatus:l.status}),j()}).subscribe();return()=>{s.unsubscribe()}},j=async()=>{try{v(!0);const{data:s,error:a}=await f.from("orders").select("*").order("created_at",{ascending:!1});if(a)throw a;const{data:r,error:l}=await f.from("food_items").select("id");if(l)throw l;const _=new Date;_.setHours(0,0,0,0);const S=(s==null?void 0:s.filter(t=>new Date(t.created_at)>=_))||[],T=(s==null?void 0:s.filter(t=>t.status==="pending"||t.status==="preparing"))||[],I=(s==null?void 0:s.filter(t=>t.status==="completed"))||[],P=((s==null?void 0:s.filter(t=>t.status!=="cancelled"))||[]).reduce((t,c)=>t+parseFloat(c.total_amount||0),0)||0,F=S.filter(t=>t.status!=="cancelled").reduce((t,c)=>t+parseFloat(c.total_amount||0),0);k({totalOrders:(s==null?void 0:s.length)||0,pendingOrders:T.length,totalRevenue:P,totalMenuItems:(r==null?void 0:r.length)||0,todayOrders:S.length,todaySales:F,completedOrders:I.length}),A((s==null?void 0:s.slice(0,5))||[]);const V=(s==null?void 0:s.slice(0,3).map((t,c)=>({id:t.id,type:t.status==="pending"?"new_order":"order_update",message:t.status==="pending"?`New order #${t.id.slice(-4)} received`:`Order #${t.id.slice(-4)} ${t.status}`,time:w(t.created_at),unread:c<2})))||[];p(V)}catch(s){console.error("Error fetching dashboard data:",s)}finally{v(!1)}},w=s=>{const a=new Date,r=new Date(s),l=Math.floor((a.getTime()-r.getTime())/(1e3*60));return l<1?"Just now":l<60?`${l} min ago`:l<1440?`${Math.floor(l/60)} hour${Math.floor(l/60)>1?"s":""} ago`:`${Math.floor(l/1440)} day${Math.floor(l/1440)>1?"s":""} ago`},D=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"preparing":return"bg-blue-100 text-blue-800";case"ready":return"bg-purple-100 text-purple-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},O=s=>{p(i.map(a=>a.id===s?{...a,unread:!1}:a))},E=()=>{p(i.map(s=>({...s,unread:!1})))};if(h||C)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})});if(!g||!u)return null;const R=[{title:"Point of Sale",description:"Process dine-in and walk-in orders",icon:"ri-cash-line",path:"/admin/pos",color:"bg-green-500"},{title:"Manage Orders",description:"View and update order status",icon:"ri-shopping-bag-line",path:"/admin/orders",color:"bg-blue-500"},{title:"Manage Menu",description:"Add, edit, or remove menu items",icon:"ri-restaurant-line",path:"/admin/menu",color:"bg-orange-500"},{title:"View Reports",description:"Sales and performance analytics",icon:"ri-bar-chart-line",path:"/admin/reports",color:"bg-purple-500"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(U,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",(n==null?void 0:n.full_name)||(n==null?void 0:n.email)]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>y(!b),className:"relative p-2 text-gray-600 hover:text-gray-900",children:[e.jsx("i",{className:"ri-notification-line text-xl"}),i.some(s=>s.unread)&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"})]}),b&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"}),i.some(s=>s.unread)&&e.jsx("button",{onClick:E,className:"text-sm text-orange-600 hover:text-orange-700",children:"Mark all read"})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:i.length>0?i.map(s=>e.jsx("div",{className:`p-3 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ${s.unread?"bg-orange-50":""}`,onClick:()=>O(s.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center mr-3 ${s.type==="new_order"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("i",{className:`${s.type==="new_order"?"ri-shopping-bag-line text-green-600":"ri-refresh-line text-blue-600"} text-sm`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.message}),e.jsx("p",{className:"text-xs text-gray-600",children:s.time})]}),s.unread&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"})]})},s.id)):e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx("i",{className:"ri-notification-off-line text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No notifications"})]})}),e.jsx("div",{className:"p-3 border-t border-gray-200",children:e.jsx("button",{className:"w-full text-center text-sm text-orange-600 hover:text-orange-700",children:"View all notifications"})})]}),b&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>y(!1)})]})]})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-shopping-bag-line text-xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Today's Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.todayOrders})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Today's Sales"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$(x.todaySales)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-time-line text-xl text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.pendingOrders})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-check-line text-xl text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.completedOrders})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:R.map((s,a)=>e.jsxs("button",{onClick:()=>o(s.path),className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left transition-colors",children:[e.jsx("div",{className:`w-10 h-10 ${s.color} rounded-lg flex items-center justify-center mb-3`,children:e.jsx("i",{className:`${s.icon} text-white`})}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]},a))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Orders"}),e.jsx(B,{onClick:()=>o("/admin/orders"),variant:"outline",className:"text-sm px-4 py-2 whitespace-nowrap",children:"View All"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Order ID"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Time"})]})}),e.jsx("tbody",{children:N.length>0?N.map(s=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-3 px-4",children:["#",s.id.slice(-4)]}),e.jsx("td",{className:"py-3 px-4",children:s.customer_name}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full capitalize ${D(s.status)}`,children:s.status})}),e.jsx("td",{className:"py-3 px-4",children:$(parseFloat(s.total_amount))}),e.jsx("td",{className:"py-3 px-4",children:w(s.created_at)})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-500",children:"No orders found"})})})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-4",children:[i.slice(0,5).map(s=>e.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${s.unread?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,onClick:()=>O(s.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center mr-3 ${s.type==="new_order"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("i",{className:`${s.type==="new_order"?"ri-shopping-bag-line text-green-600":"ri-refresh-line text-blue-600"} text-sm`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.message}),e.jsx("p",{className:"text-xs text-gray-600",children:s.time})]}),s.unread&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"})]})},s.id)),i.length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("i",{className:"ri-notification-off-line text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No recent activity"})]})]})]})]})]})]})]})};export{Y as default};
//# sourceMappingURL=page-C37Tc7qx.js.map
