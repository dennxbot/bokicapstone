import{u as E,r as h,j as e}from"./index-rA_UgCij.js";import{u as L,s as A}from"./useAuth-CjWk1XML.js";import{B as V}from"./Button-CaIT6pSL.js";import{f as g}from"./currency-XAUvB6j1.js";import{A as S}from"./AdminSidebar-CLXZbcRD.js";const Y=()=>{const y=E(),{isLoading:u,isAuthenticated:j,isAdmin:f}=L(),[x,w]=h.useState("today"),[t,O]=h.useState(null),[D,N]=h.useState(!1);h.useEffect(()=>{if(!u){if(!j||!f){y("/login");return}_()}},[j,f,u,y,x]);const I=()=>{const l=new Date,r=new Date(l.getFullYear(),l.getMonth(),l.getDate());switch(x){case"today":return{start:r.toISOString(),end:new Date(r.getTime()+1440*60*1e3).toISOString()};case"week":const s=new Date(r);return s.setDate(r.getDate()-r.getDay()),{start:s.toISOString(),end:l.toISOString()};case"month":return{start:new Date(r.getFullYear(),r.getMonth(),1).toISOString(),end:l.toISOString()};default:return{start:r.toISOString(),end:new Date(r.getTime()+1440*60*1e3).toISOString()}}},_=async()=>{try{N(!0);const{start:l,end:r}=I(),{data:s,error:d}=await A.from("orders").select(`
          *,
          order_items (
            *,
            food_items (
              name
            )
          )
        `).gte("created_at",l).lt("created_at",r);if(d)throw d;const n=(s==null?void 0:s.filter(a=>a.status!=="cancelled"))||[],B=(s==null?void 0:s.length)||0,v=n.reduce((a,i)=>a+i.total_amount,0)||0,k=n.length>0?v/n.length:0,T={pending:(s==null?void 0:s.filter(a=>a.status==="pending").length)||0,preparing:(s==null?void 0:s.filter(a=>a.status==="preparing").length)||0,ready:(s==null?void 0:s.filter(a=>a.status==="ready").length)||0,out_for_delivery:(s==null?void 0:s.filter(a=>a.status==="out_for_delivery").length)||0,completed:(s==null?void 0:s.filter(a=>a.status==="completed").length)||0,cancelled:(s==null?void 0:s.filter(a=>a.status==="cancelled").length)||0},c={};n.forEach(a=>{var i;(i=a.order_items)==null||i.forEach(p=>{var b;const m=((b=p.food_items)==null?void 0:b.name)||"Unknown Item";c[m]||(c[m]={name:m,quantity:0,revenue:0}),c[m].quantity+=p.quantity,c[m].revenue+=p.total_price})});const $=Object.values(c).sort((a,i)=>i.quantity-a.quantity).slice(0,5),o={};n.forEach(a=>{const i=a.created_at.split("T")[0];o[i]||(o[i]={orders:0,sales:0}),o[i].orders+=1,o[i].sales+=a.total_amount});const C=Object.entries(o).map(([a,i])=>({date:a,...i})).sort((a,i)=>a.date.localeCompare(i.date)).slice(-7);O({totalOrders:B,totalSales:v,avgOrderValue:k,topSellingItems:$,dailySales:C,ordersByStatus:T})}catch(l){console.error("Error fetching report data:",l)}finally{N(!1)}},R=()=>{if(!t)return;const l=[["Metric","Value"],["Total Orders",t.totalOrders.toString()],["Total Sales",`$${t.totalSales.toFixed(2)}`],["Average Order Value",`$${t.avgOrderValue.toFixed(2)}`],[""],["Orders by Status",""],["Pending",t.ordersByStatus.pending.toString()],["Preparing",t.ordersByStatus.preparing.toString()],["Ready",t.ordersByStatus.ready.toString()],["Out for Delivery",t.ordersByStatus.out_for_delivery.toString()],["Completed",t.ordersByStatus.completed.toString()],["Cancelled",t.ordersByStatus.cancelled.toString()],[""],["Top Selling Items",""],["Item Name","Quantity","Revenue"],...t.topSellingItems.map(n=>[n.name,n.quantity.toString(),`$${n.revenue.toFixed(2)}`]),[""],["Daily Sales",""],["Date","Orders","Sales"],...t.dailySales.map(n=>[n.date,n.orders.toString(),`$${n.sales.toFixed(2)}`])].map(n=>n.join(",")).join("\\n"),r=new Blob([l],{type:"text/csv"}),s=window.URL.createObjectURL(r),d=document.createElement("a");d.href=s,d.download=`sales-report-${x}-${new Date().toISOString().split("T")[0]}.csv`,d.click(),window.URL.revokeObjectURL(s)};return u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):!j||!f?null:D||!t?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(S,{}),e.jsx("div",{className:"flex-1 ml-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line text-4xl text-orange-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading reports..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(S,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Reports"}),e.jsx("p",{className:"text-gray-600",children:"View detailed sales analytics from database"})]}),e.jsxs(V,{onClick:R,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Export CSV"]})]})})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Report Period"}),e.jsx("div",{className:"flex space-x-1",children:[{key:"today",label:"Today"},{key:"week",label:"This Week"},{key:"month",label:"This Month"}].map(l=>e.jsx("button",{onClick:()=>w(l.key),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${x===l.key?"bg-orange-100 text-orange-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:l.label},l.key))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-shopping-bag-line text-xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.totalOrders})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g(t.totalSales)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-bar-chart-line text-xl text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Order Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g(t.avgOrderValue)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Selling Items"}),t.topSellingItems.length>0?e.jsx("div",{className:"space-y-4",children:t.topSellingItems.map((l,r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-sm font-bold text-orange-600",children:r+1})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.quantity," sold"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-green-600",children:g(l.revenue)})})]},r))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"ri-shopping-cart-line text-3xl mb-2"}),e.jsx("p",{children:"No sales data for this period"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Orders by Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-400 rounded-full mr-3"}),e.jsx("span",{children:"Pending"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.pending})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-400 rounded-full mr-3"}),e.jsx("span",{children:"Preparing"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.preparing})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-400 rounded-full mr-3"}),e.jsx("span",{children:"Ready"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.ready})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-400 rounded-full mr-3"}),e.jsx("span",{children:"Out for Delivery"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.out_for_delivery})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-green-400 rounded-full mr-3"}),e.jsx("span",{children:"Completed"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.completed})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded-full mr-3"}),e.jsx("span",{children:"Cancelled"})]}),e.jsx("span",{className:"font-semibold",children:t.ordersByStatus.cancelled})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Daily Sales Trend"}),t.dailySales.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex items-end space-x-2 h-64 min-w-full",children:t.dailySales.map((l,r)=>{const s=Math.max(...t.dailySales.map(n=>n.sales)),d=s>0?l.sales/s*200:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:g(l.sales)}),e.jsx("div",{className:"bg-orange-400 rounded-t w-full min-w-8",style:{height:`${Math.max(d,4)}px`}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 transform -rotate-45 origin-left",children:new Date(l.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},r)})})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"ri-bar-chart-line text-3xl mb-2"}),e.jsx("p",{children:"No sales data for this period"})]})]})]})]})]})};export{Y as default};
//# sourceMappingURL=page-DFcabGJw.js.map
