import{u as K,r as l,j as e}from"./index-rA_UgCij.js";import{u as Q,s as m}from"./useAuth-CjWk1XML.js";import{u as V}from"./useSizes-DUu48KPE.js";import{f as W}from"./currency-XAUvB6j1.js";import{A as X}from"./AdminSidebar-CLXZbcRD.js";import{B as _}from"./Button-CaIT6pSL.js";import{I as S}from"./Input-CP5KOtNX.js";const ie=()=>{const k=K(),{isLoading:j,isAuthenticated:v,isAdmin:N}=Q(),{sizeOptions:C,fetchAllSizeOptions:$,assignSizesToFoodItem:z,getFoodItemSizes:D}=V(),[n,g]=l.useState([]),[E,M]=l.useState([]),[P,f]=l.useState(!1),[o,w]=l.useState(null),[u,I]=l.useState("all"),[U,A]=l.useState(!0),[x,d]=l.useState([]),[t,p]=l.useState({name:"",description:"",price:"",category_id:"",image_url:"",is_available:!0,is_featured:!1});l.useEffect(()=>{if(!j){if(!v||!N){k("/admin/login");return}L(),$()}},[v,N,j,k]);const L=async()=>{try{A(!0);const{data:a,error:s}=await m.from("categories").select("*").eq("is_active",!0).order("name");if(s)throw s;const{data:r,error:i}=await m.from("food_items").select(`
          *,
          category:categories(name),
          food_item_sizes(
            size_option:size_options(
              id,
              name,
              price_multiplier
            ),
            is_available
          )
        `).order("name");if(i)throw i;M(a||[]);const h=(r||[]).map(b=>{var F;const J=((F=b.food_item_sizes)==null?void 0:F.map(y=>({id:y.size_option.id,name:y.size_option.name,price_multiplier:y.size_option.price_multiplier,is_available:y.is_available})))||[];return{...b,is_featured:b.is_featured??!1,image_url:b.image_url||"",sizes:J}});g(h)}catch(a){console.error("Error fetching menu data:",a)}finally{A(!1)}},c=a=>{const s=a.target.type==="checkbox"?a.target.checked:a.target.value;p({...t,[a.target.name]:s})},O=async()=>{if(!t.name||!t.price||!t.category_id){alert("Please fill in all required fields");return}try{const a=t.image_url||`https://readdy.ai/api/search-image?query=delicious%20$%7BnewItem.name%7D%20food%20photography%20with%20simple%20clean%20background%2C%20professional%20food%20styling%2C%20appetizing%20presentation&width=400&height=300&seq=${Date.now()}&orientation=landscape`,{data:s,error:r}=await m.from("food_items").insert([{name:t.name,description:t.description,price:parseFloat(t.price),category_id:t.category_id,image_url:a,is_available:t.is_available,is_featured:t.is_featured||!1}]).select(`
          *,
          category:categories(name)
        `);if(r)throw r;if(s&&s.length>0){const i=s[0];x.length>0&&await z(i.id,x),g([...n,...s])}p({name:"",description:"",price:"",category_id:"",image_url:"",is_available:!0,is_featured:!1}),d([]),f(!1)}catch(a){console.error("Error adding menu item:",a),alert("Error adding menu item. Please try again.")}},B=async a=>{w(a),p({name:a.name,description:a.description||"",price:a.price.toString(),category_id:a.category_id,image_url:a.image_url||"",is_available:a.is_available,is_featured:a.is_featured||!1});try{const r=(await D(a.id)).map(i=>i.size_option_id);d(r)}catch(s){console.error("Error loading existing sizes:",s),d([])}},R=async()=>{if(!o||!t.name||!t.price||!t.category_id){alert("Please fill in all required fields");return}try{const{data:a,error:s}=await m.from("food_items").update({name:t.name,description:t.description,price:parseFloat(t.price),category_id:t.category_id,image_url:t.image_url,is_available:t.is_available,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",o.id).select(`
          *,
          category:categories(name)
        `);if(s)throw s;a&&a.length>0&&(await z(o.id,x),g(n.map(r=>r.id===o.id?a[0]:r))),w(null),d([]),p({name:"",description:"",price:"",category_id:"",image_url:"",is_available:!0,is_featured:!1})}catch(a){console.error("Error updating menu item:",a),alert("Error updating menu item. Please try again.")}},T=async a=>{if(confirm("Are you sure you want to delete this item?"))try{const{error:s}=await m.from("food_items").delete().eq("id",a);if(s)throw s;g(n.filter(r=>r.id!==a))}catch(s){console.error("Error deleting menu item:",s),alert("Error deleting menu item. Please try again.")}},G=async(a,s)=>{try{console.log("Toggling availability for item:",a,"from",s,"to",!s);const{data:r,error:i}=await m.from("food_items").update({is_available:!s,updated_at:new Date().toISOString()}).eq("id",a).select();if(i)throw console.error("Supabase error:",i),i;console.log("Update successful, returned data:",r),g(n.map(h=>h.id===a?{...h,is_available:!s}:h)),console.log("Local state updated")}catch(r){console.error("Error updating availability:",r),alert("Error updating availability. Please try again.")}},H=async(a,s)=>{try{const{error:r}=await m.from("food_items").update({is_featured:!s,updated_at:new Date().toISOString()}).eq("id",a);if(r)throw r;g(n.map(i=>i.id===a?{...i,is_featured:!s}:i))}catch(r){console.error("Error updating featured status:",r),alert("Error updating featured status. Please try again.")}},q=u==="all"?n:u==="featured"?n.filter(a=>a.is_featured):n.filter(a=>a.category_id===u);return j||U?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):!v||!N?null:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(X,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Menu Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage your restaurant menu items"})]}),e.jsxs(_,{onClick:()=>f(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Add Item"]})]})})}),e.jsxs("div",{className:"p-6",children:[(P||o)&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:o?"Edit Menu Item":"Add New Menu Item"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"Item Name",name:"name",value:t.name,onChange:c,required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:c,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsx(S,{label:"Price",name:"price",type:"number",step:"0.01",value:t.price,onChange:c,required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{name:"category_id",value:t.category_id,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 pr-8",required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),E.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsx(S,{label:"Image URL (optional)",name:"image_url",value:t.image_url,onChange:c}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_available",checked:t.is_available,onChange:c,className:"mr-2"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Available for order"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_featured",checked:t.is_featured||!1,onChange:c,className:"mr-2"}),e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"ri-star-line mr-1"}),"Featured item"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Sizes (optional)"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:[C.map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`size-${a.id}`,checked:x.includes(a.id),onChange:s=>{s.target.checked?d([...x,a.id]):d(x.filter(r=>r!==a.id))},className:"mr-2"}),e.jsxs("label",{htmlFor:`size-${a.id}`,className:"text-sm text-gray-700 flex-1",children:[a.name," ",a.price_multiplier!==1&&`(${a.price_multiplier}x price)`]})]},a.id)),C.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No size options available"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select which sizes are available for this menu item. If no sizes are selected, the item will use the default size."})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(_,{onClick:o?R:O,className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white py-2 whitespace-nowrap",children:o?"Update Item":"Add Item"}),e.jsx(_,{onClick:()=>{f(!1),w(null),d([]),p({name:"",description:"",price:"",category_id:"",image_url:"",is_available:!0,is_featured:!1})},variant:"outline",className:"flex-1 border-gray-300 text-gray-700 py-2 whitespace-nowrap",children:"Cancel"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>I("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${u==="all"?"bg-orange-100 text-orange-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"All Items"}),e.jsxs("button",{onClick:()=>I("featured"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${u==="featured"?"bg-orange-100 text-orange-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-star-line mr-1"}),"Featured"]}),E.map(a=>e.jsx("button",{onClick:()=>I(a.id),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${u===a.id?"bg-orange-100 text-orange-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:a.name},a.id))]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.filter(a=>a&&a.id).map(a=>{var s;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.image_url||`https://readdy.ai/api/search-image?query=delicious%20food%20photography%20with%20simple%20clean%20background&width=400&height=300&seq=${a.id}&orientation=landscape`,alt:a.name||"Food item",className:"w-full h-48 object-cover object-top"}),e.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>G(a.id,a.is_available),className:`px-2 py-1 rounded-full text-xs font-medium ${a.is_available?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.is_available?"Available":"Unavailable"}),a.is_featured&&e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[e.jsx("i",{className:"ri-star-fill mr-1"}),"Featured"]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.name}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:W(a.price)})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("span",{className:"text-xs text-gray-500 capitalize bg-gray-100 px-2 py-1 rounded",children:((s=a.category)==null?void 0:s.name)||"No Category"})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"Available Sizes:"}),a.sizes&&a.sizes.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:a.sizes.map(r=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${r.is_available?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[r.name,r.price_multiplier!==1&&e.jsxs("span",{className:"ml-1 text-xs opacity-75",children:["(",r.price_multiplier,"x)"]})]},r.id))}):e.jsx("span",{className:"text-xs text-gray-400 italic",children:"No sizes configured"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:()=>H(a.id,a.is_featured),className:`flex items-center px-3 py-1 rounded-full text-xs font-medium transition-colors ${a.is_featured?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("i",{className:`${a.is_featured?"ri-star-fill":"ri-star-line"} mr-1`}),a.is_featured?"Featured":"Feature"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>B(a),className:"text-blue-600 hover:text-blue-700",children:e.jsx("i",{className:"ri-edit-line"})}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-600 hover:text-red-700",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]})]})]},a.id)})}),q.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx("i",{className:"ri-restaurant-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No menu items found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No items match the selected category."}),e.jsx(_,{onClick:()=>f(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 whitespace-nowrap",children:"Add First Item"})]})]})]})]})};export{ie as default};
//# sourceMappingURL=page-Cq8M1tdc.js.map
