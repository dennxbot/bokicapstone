{"version":3,"file":"page-Ck5WRK4J.js","sources":["../../src/pages/checkout/page.tsx"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useCart } from '../../hooks/useCart';\r\nimport { useAuth } from '../../hooks/useAuth';\r\nimport { useAddresses } from '../../hooks/useAddresses';\r\nimport { formatPesoSimple } from '../../lib/currency';\r\nimport Button from '../../components/base/Button';\r\nimport Input from '../../components/base/Input';\r\n\r\nconst Checkout = () => {\r\n  const navigate = useNavigate();\r\n  const { items: cartItems, getTotalPrice, createOrder } = useCart();\r\n  const { user } = useAuth();\r\n  const { addresses, loadAddresses, getDefaultAddress } = useAddresses();\r\n  const [formData, setFormData] = useState({\r\n    fullName: '',\r\n    contactNumber: '',\r\n    selectedAddressId: '',\r\n    deliveryMethod: 'delivery',\r\n    paymentMethod: 'cash'\r\n  });\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadAddresses();\r\n  }, [loadAddresses]);\r\n\r\n  useEffect(() => {\r\n    const defaultAddress = getDefaultAddress();\r\n    if (defaultAddress) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        selectedAddressId: defaultAddress.id\r\n      }));\r\n    }\r\n  }, [addresses, getDefaultAddress]);\r\n\r\n  // Auto-populate customer information when user data is available\r\n  useEffect(() => {\r\n    if (user) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        fullName: user.full_name || '',\r\n        contactNumber: user.contact_number || ''\r\n      }));\r\n    }\r\n  }, [user]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  const handlePlaceOrder = async () => {\r\n    if (!formData.fullName || !formData.contactNumber || !formData.selectedAddressId) {\r\n      alert('Please fill in all required fields and select an address');\r\n      return;\r\n    }\r\n\r\n    if (!user) {\r\n      alert('Please login to place an order');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    const selectedAddress = addresses.find(addr => addr.id === formData.selectedAddressId);\r\n    if (!selectedAddress) {\r\n      alert('Please select a valid address');\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      const order = await createOrder({\r\n        customerName: formData.fullName,\r\n        customerEmail: user.email || '',\r\n        customerPhone: formData.contactNumber,\r\n        customerAddress: `${selectedAddress.address_line_1}${selectedAddress.address_line_2 ? ', ' + selectedAddress.address_line_2 : ''}, ${selectedAddress.city}, ${selectedAddress.state} ${selectedAddress.postal_code}, ${selectedAddress.country}`,\r\n        orderType: formData.deliveryMethod as 'delivery' | 'pickup',\r\n        paymentMethod: formData.paymentMethod as 'cash' | 'card',\r\n        userId: user.id,\r\n      });\r\n\r\n      navigate(`/order-confirmation/${order.id}`);\r\n    } catch (error) {\r\n      console.error('Error placing order:', error);\r\n      alert('Failed to place order. Please try again.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (cartItems.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Your cart is empty</h2>\r\n          <Button onClick={() => navigate('/')}>Continue Shopping</Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 pb-20\">\r\n      <div className=\"bg-white shadow-sm\">\r\n        <div className=\"max-w-md mx-auto px-4 py-4\">\r\n          <div className=\"flex items-center\">\r\n            <button onClick={() => navigate('/cart')} className=\"mr-4\">\r\n              <i className=\"ri-arrow-left-line text-xl\"></i>\r\n            </button>\r\n            <h1 className=\"text-xl font-bold\">Checkout</h1>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-md mx-auto px-4 py-6\">\r\n        {/* Order Summary */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Order Summary</h2>\r\n          {cartItems.map((item) => (\r\n            <div key={`${item.id}-${item.size_option_id || 'default'}`} className=\"flex justify-between items-center py-2\">\r\n              <div>\r\n                <p className=\"font-medium\">{item.name}</p>\r\n                <p className=\"text-sm text-gray-600\">Qty: {item.quantity}</p>\r\n              </div>\r\n              <p className=\"font-semibold\">{formatPesoSimple(item.price * item.quantity)}</p>\r\n            </div>\r\n          ))}\r\n          <div className=\"border-t pt-2 mt-2\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <p className=\"text-lg font-bold\">Total</p>\r\n              <p className=\"text-lg font-bold text-orange-600\">{formatPesoSimple(getTotalPrice())}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Customer Information */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Customer Information</h2>\r\n          <div className=\"space-y-4\">\r\n            <Input\r\n              label=\"Full Name\"\r\n              name=\"fullName\"\r\n              value={formData.fullName}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n            <Input\r\n              label=\"Contact Number\"\r\n              name=\"contactNumber\"\r\n              type=\"tel\"\r\n              value={formData.contactNumber}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n            \r\n            {/* Address Selection */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Delivery Address *\r\n              </label>\r\n              {addresses.length > 0 ? (\r\n                <div className=\"space-y-2\">\r\n                  {addresses.map((address) => (\r\n                    <label key={address.id} className=\"flex items-start p-3 border rounded-lg cursor-pointer hover:bg-gray-50\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"selectedAddressId\"\r\n                        value={address.id}\r\n                        checked={formData.selectedAddressId === address.id}\r\n                        onChange={handleInputChange}\r\n                        className=\"mt-1 mr-3\"\r\n                      />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium text-gray-900\">{address.label}</span>\r\n                          {address.is_default && (\r\n                            <span className=\"ml-2 px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded\">\r\n                              Default\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-600 mt-1\">\r\n                          {address.address_line_1}\r\n                          {address.address_line_2 && `, ${address.address_line_2}`}\r\n                          <br />\r\n                          {address.city}, {address.state} {address.postal_code}\r\n                          <br />\r\n                          {address.country}\r\n                        </p>\r\n                      </div>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-4 text-gray-500\">\r\n                  <p>No addresses found.</p>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => navigate('/profile')}\r\n                    className=\"text-orange-600 hover:text-orange-700 font-medium mt-2\"\r\n                  >\r\n                    Add an address in your profile\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Delivery Method */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Delivery Method</h2>\r\n          <div className=\"space-y-2\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"radio\"\r\n                name=\"deliveryMethod\"\r\n                value=\"delivery\"\r\n                checked={formData.deliveryMethod === 'delivery'}\r\n                onChange={handleInputChange}\r\n                className=\"mr-3\"\r\n              />\r\n              <span>Delivery</span>\r\n            </label>\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"radio\"\r\n                name=\"deliveryMethod\"\r\n                value=\"pickup\"\r\n                checked={formData.deliveryMethod === 'pickup'}\r\n                onChange={handleInputChange}\r\n                className=\"mr-3\"\r\n              />\r\n              <span>Pickup</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Payment Method */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Payment Method</h2>\r\n          <div className=\"space-y-2\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"radio\"\r\n                name=\"paymentMethod\"\r\n                value=\"cash\"\r\n                checked={formData.paymentMethod === 'cash'}\r\n                onChange={handleInputChange}\r\n                className=\"mr-3\"\r\n              />\r\n              <span>{formData.deliveryMethod === 'delivery' ? 'Cash on Delivery' : 'Pay on Pickup'}</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <Button\r\n          onClick={handlePlaceOrder}\r\n          disabled={isSubmitting}\r\n          className=\"w-full bg-orange-600 hover:bg-orange-700 text-white py-3 rounded-lg font-semibold whitespace-nowrap\"\r\n        >\r\n          {isSubmitting ? (\r\n            <>\r\n              <i className=\"ri-loader-4-line animate-spin mr-2\" />\r\n              Placing Order...\r\n            </>\r\n          ) : (\r\n            <>\r\n              Place Order - {formatPesoSimple(getTotalPrice())}\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n"],"names":["Checkout","navigate","useNavigate","cartItems","getTotalPrice","createOrder","useCart","user","useAuth","addresses","loadAddresses","getDefaultAddress","useAddresses","formData","setFormData","useState","isSubmitting","setIsSubmitting","useEffect","defaultAddress","prev","handleInputChange","e","handlePlaceOrder","selectedAddress","addr","order","error","jsxs","jsx","Button","item","formatPesoSimple","Input","address","Fragment"],"mappings":"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"}