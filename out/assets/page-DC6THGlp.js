import{u as O,r as l,j as t}from"./index-rA_UgCij.js";import{u as S,s as f}from"./useAuth-CjWk1XML.js";import{f as C}from"./currency-XAUvB6j1.js";import{B as j}from"./Button-CaIT6pSL.js";import{A as M}from"./AdminSidebar-CLXZbcRD.js";const E=()=>{const m=O(),{isLoading:n,isAuthenticated:i,isAdmin:c}=S(),[d,x]=l.useState([]),[o,b]=l.useState("all"),[N,u]=l.useState(!0);l.useEffect(()=>{if(!n){if(!i||!c){m("/login");return}v()}},[i,c,n,m]);const v=async()=>{try{u(!0);const{data:e,error:s}=await f.from("orders").select(`
          *,
          order_items (
            id,
            quantity,
            unit_price,
            size_name,
            food_item:food_items (
              name
            )
          )
        `).order("created_at",{ascending:!1});if(s)throw s;x(e||[])}catch(e){console.error("Error fetching orders:",e)}finally{u(!1)}},g=async(e,s)=>{try{const{error:r}=await f.from("orders").update({status:s,updated_at:new Date().toISOString()}).eq("id",e);if(r)throw r;x(d.map(a=>a.id===e?{...a,status:s}:a))}catch(r){console.error("Error updating order status:",r),alert("Error updating order status. Please try again.")}},_=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"preparing":return"bg-blue-100 text-blue-800";case"ready":return"bg-purple-100 text-purple-800";case"out_for_delivery":return"text-orange-600 bg-orange-100";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{const s=new Date,r=new Date(e),a=Math.floor((s.getTime()-r.getTime())/(1e3*60));return a<1?"Just now":a<60?`${a} min ago`:a<1440?`${Math.floor(a/60)} hour${Math.floor(a/60)>1?"s":""} ago`:`${Math.floor(a/1440)} day${Math.floor(a/1440)>1?"s":""} ago`},p=(e,s)=>{switch(e){case"pending":return"preparing";case"preparing":return s==="delivery"?"out_for_delivery":"ready";case"ready":return"completed";case"out_for_delivery":return"completed";default:return null}},k=(e,s)=>{switch(e){case"pending":return"Start Preparing";case"preparing":return s==="delivery"?"Out for Delivery":"Ready for Pickup";case"ready":return"Mark Completed";case"out_for_delivery":return"Mark Delivered";default:return null}},h=o==="all"?d:d.filter(e=>e.status===o);return n||N?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):!i||!c?null:t.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[t.jsx(M,{}),t.jsxs("div",{className:"flex-1 ml-64",children:[t.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:t.jsxs("div",{className:"px-6 py-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage all customer orders"})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:t.jsx("div",{className:"flex space-x-1",children:[{key:"all",label:"All Orders"},{key:"pending",label:"Pending"},{key:"preparing",label:"Preparing"},{key:"ready",label:"Ready"},{key:"out_for_delivery",label:"Out for Delivery"},{key:"completed",label:"Completed"}].map(e=>t.jsx("button",{onClick:()=>b(e.key),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${o===e.key?"bg-orange-100 text-orange-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:e.label},e.key))})}),t.jsx("div",{className:"space-y-4",children:h.length===0?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[t.jsx("i",{className:"ri-shopping-bag-line text-4xl text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No orders found"}),t.jsx("p",{className:"text-gray-600",children:"No orders match the selected filter."})]}):h.map(e=>{var s;return t.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["Order #",e.id.slice(-8)]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[e.customer_name," â€¢ ",w(e.created_at)]})]}),t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium capitalize ${_(e.status)}`,children:e.status.replace("-"," ")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Items"}),t.jsx("div",{className:"space-y-1",children:((s=e.order_items)==null?void 0:s.map((r,a)=>{var y;return t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("span",{children:[r.quantity,"x ",((y=r.food_item)==null?void 0:y.name)||"Unknown Item"]}),r.size_name&&t.jsxs("span",{className:"text-gray-500 ml-1",children:["(",r.size_name,")"]})]},a)}))||t.jsx("p",{className:"text-sm text-gray-500",children:"No items found"})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Customer Info"}),t.jsx("p",{className:"text-sm text-gray-600",children:e.customer_phone}),t.jsx("p",{className:"text-sm text-gray-600",children:e.customer_email}),e.customer_address&&t.jsx("p",{className:"text-sm text-gray-600",children:e.customer_address})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Details"}),t.jsx("p",{className:"text-sm text-gray-600 capitalize",children:e.order_type||"pickup"}),t.jsx("p",{className:"text-sm text-gray-600 capitalize",children:e.payment_method==="cash"?e.order_type==="delivery"?"Cash on Delivery":"Pay on Pickup":e.payment_method||"Cash"}),t.jsx("p",{className:"text-sm font-semibold text-orange-600",children:C(e.total_amount)}),e.notes&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Note: ",e.notes]})]})]})]}),e.status!=="completed"&&e.status!=="cancelled"&&t.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 lg:mt-0 lg:ml-6",children:[p(e.status,e.order_type)&&t.jsx(j,{onClick:()=>g(e.id,p(e.status,e.order_type)),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm whitespace-nowrap",children:k(e.status,e.order_type)}),e.status==="pending"&&t.jsx(j,{onClick:()=>g(e.id,"cancelled"),variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50 px-4 py-2 text-sm whitespace-nowrap",children:"Cancel Order"})]})]})},e.id)})})]})]})]})};export{E as default};
//# sourceMappingURL=page-DC6THGlp.js.map
