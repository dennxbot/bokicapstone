import{u as q,r as d,j as e}from"./index-rA_UgCij.js";import{u as z,s as j}from"./useAuth-CjWk1XML.js";import{f as c}from"./currency-XAUvB6j1.js";import{B as w}from"./Button-CaIT6pSL.js";import{A as B}from"./AdminSidebar-CLXZbcRD.js";const P=()=>{const f=q(),{isLoading:x,isAuthenticated:m,isAdmin:h}=z(),[r,_]=d.useState([]),[g,O]=d.useState(null),[N,S]=d.useState([]),[C,y]=d.useState(!1),[A,b]=d.useState(!0);d.useEffect(()=>{if(!x){if(!m||!h){f("/login");return}D()}},[m,h,x,f]);const D=async()=>{try{b(!0);const{data:s,error:t}=await j.from("users").select("*").neq("role","admin").order("created_at",{ascending:!1});if(t)throw t;const{data:a,error:i}=await j.from("orders").select("user_id, total_amount, created_at, status");if(i)throw i;const o=(s==null?void 0:s.map(l=>{const u=(a==null?void 0:a.filter(n=>n.user_id===l.id))||[],T=u.length,k=u.reduce((n,p)=>n+parseFloat(p.total_amount||"0"),0),v=u.sort((n,p)=>new Date(p.created_at).getTime()-new Date(n.created_at).getTime())[0];return{id:l.id,full_name:l.full_name,email:l.email,contact_number:l.contact_number||"N/A",totalOrders:T,totalSpent:k,lastOrderDate:v?v.created_at:l.created_at,created_at:l.created_at}}))||[];_(o)}catch(s){console.error("Error fetching customers:",s)}finally{b(!1)}},E=async s=>{try{O(s);const{data:t,error:a}=await j.from("orders").select(`
          id,
          created_at,
          total_amount,
          status,
          order_items (
            quantity,
            size_name,
            food_item:food_items (
              name
            )
          )
        `).eq("user_id",s.id).order("created_at",{ascending:!1});if(a)throw a;S(t||[]),y(!0)}catch(t){console.error("Error fetching customer orders:",t)}},L=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"preparing":return"bg-blue-100 text-blue-800";case"ready":return"bg-purple-100 text-purple-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return x||A?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):!m||!h?null:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(B,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage all customer information"})]})}),C&&g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:[g.full_name,"'s Orders"]}),e.jsx("p",{className:"text-gray-600",children:g.email})]}),e.jsx(w,{onClick:()=>y(!1),variant:"outline",className:"border-gray-300 text-gray-700 px-4 py-2 whitespace-nowrap",children:"Back to Customers"})]}),e.jsx("div",{className:"space-y-4",children:N.length>0?N.map(s=>{var t;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Order #",s.id.slice(-8)]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(s.created_at).toLocaleDateString()," at ",new Date(s.created_at).toLocaleTimeString()]}),e.jsx("div",{className:"space-y-1",children:(t=s.order_items)==null?void 0:t.map((a,i)=>{var o;return e.jsxs("p",{className:"text-sm text-gray-700",children:["â€¢ ",a.quantity,"x ",((o=a.food_item)==null?void 0:o.name)||"Unknown Item",a.size_name&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",a.size_name,")"]})]},i)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-orange-600",children:c(s.total_amount)}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full capitalize ${L(s.status)}`,children:s.status})]})]})},s.id)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"ri-shopping-bag-line text-4xl mb-4"}),e.jsx("p",{children:"No orders found for this customer"})]})})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-user-line text-xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-shopping-bag-line text-xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.reduce((s,t)=>s+t.totalOrders,0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-xl text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(r.reduce((s,t)=>s+t.totalSpent,0))})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-user-star-line text-xl text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Order Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.length>0&&r.reduce((s,t)=>s+t.totalOrders,0)>0?c(r.reduce((s,t)=>s+t.totalSpent,0)/r.reduce((s,t)=>s+t.totalOrders,0)):c(0)})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold",children:"All Customers"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Contact"}),e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Orders"}),e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Last Order"}),e.jsx("th",{className:"text-left py-3 px-6 font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:r.length>0?r.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-900",children:s.contact_number})})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:"font-semibold text-gray-900",children:s.totalOrders})}),e.jsx("td",{className:"py-3 px-4",children:c(s.totalSpent)}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.totalOrders>0?new Date(s.lastOrderDate).toLocaleDateString():"No orders"})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx(w,{onClick:()=>E(s),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm whitespace-nowrap",disabled:s.totalOrders===0,children:"View Orders"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 text-center text-gray-500",children:"No customers found"})})})]})})]})]})]})]})};export{P as default};
//# sourceMappingURL=page-DS3AdWEC.js.map
