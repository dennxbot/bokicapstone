import{u as P,r as l,j as e}from"./index-rA_UgCij.js";import{u as I,s as g}from"./useAuth-CjWk1XML.js";import{A as L}from"./AdminSidebar-CLXZbcRD.js";import{B as d}from"./Button-CaIT6pSL.js";import{I as w}from"./Input-CP5KOtNX.js";const O=()=>{const b=P(),{isLoading:f,isAuthenticated:y,isAdmin:j}=I(),[o,m]=l.useState([]),[_,h]=l.useState(!1),[n,N]=l.useState(null),[C,v]=l.useState(!0),[i,x]=l.useState({name:"",description:"",image_url:"",is_active:!0});l.useEffect(()=>{if(!f){if(!y||!j){b("/login");return}k()}},[y,j,f,b]);const k=async()=>{try{v(!0);const{data:t,error:s}=await g.from("categories").select(`
          *,
          food_items(count)
        `).order("name");if(s)throw s;const r=(t==null?void 0:t.map(a=>{var c,p;return{...a,food_items_count:((p=(c=a.food_items)==null?void 0:c[0])==null?void 0:p.count)||0}}))||[];m(r)}catch(t){console.error("Error fetching categories:",t)}finally{v(!1)}},u=t=>{const{name:s,value:r,type:a}=t.target,c=t.target.checked;x(p=>({...p,[s]:a==="checkbox"?c:r}))},A=async()=>{if(!i.name.trim()){alert("Please enter a category name");return}try{const t=i.image_url||`https://readdy.ai/api/search-image?query=delicious%20${i.name}%20food%20category%20with%20appetizing%20presentation%2C%20restaurant%20quality%20photography%2C%20clean%20background&width=400&height=300&seq=${Date.now()}&orientation=landscape`,{data:s,error:r}=await g.from("categories").insert([{name:i.name.trim(),description:i.description.trim()||null,image_url:t,is_active:i.is_active}]).select("*");if(r)throw r;if(s){const a={...s[0],food_items_count:0};m([...o,a])}x({name:"",description:"",image_url:"",is_active:!0}),h(!1)}catch(t){console.error("Error adding category:",t),alert("Error adding category. Please try again.")}},E=t=>{N(t),x({name:t.name,description:t.description||"",image_url:t.image_url||"",is_active:t.is_active})},S=async()=>{if(!n||!i.name.trim()){alert("Please enter a category name");return}try{const{data:t,error:s}=await g.from("categories").update({name:i.name.trim(),description:i.description.trim()||null,image_url:i.image_url||null,is_active:i.is_active,updated_at:new Date().toISOString()}).eq("id",n.id).select("*");if(s)throw s;if(t){const r={...t[0],food_items_count:n.food_items_count};m(o.map(a=>a.id===n.id?r:a))}N(null),x({name:"",description:"",image_url:"",is_active:!0})}catch(t){console.error("Error updating category:",t),alert("Error updating category. Please try again.")}},q=async(t,s,r)=>{if(r>0){alert(`Cannot delete "${s}" because it has ${r} menu item(s) assigned to it. Please reassign or delete those items first.`);return}if(confirm(`Are you sure you want to delete the category "${s}"? This action cannot be undone.`))try{const{error:a}=await g.from("categories").delete().eq("id",t);if(a)throw a;m(o.filter(c=>c.id!==t))}catch(a){console.error("Error deleting category:",a),alert("Error deleting category. Please try again.")}},D=async(t,s)=>{try{const{error:r}=await g.from("categories").update({is_active:!s,updated_at:new Date().toISOString()}).eq("id",t);if(r)throw r;m(o.map(a=>a.id===t?{...a,is_active:!s}:a))}catch(r){console.error("Error updating category status:",r),alert("Error updating category status. Please try again.")}},$=()=>{N(null),h(!1),x({name:"",description:"",image_url:"",is_active:!0})};return f||C?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):!y||!j?null:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(L,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Category Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage food categories for your menu"})]}),e.jsxs(d,{onClick:()=>h(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Add Category"]})]})})}),e.jsxs("div",{className:"p-6",children:[(_||n)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:n?"Edit Category":"Add New Category"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Category Name",name:"name",value:i.name,onChange:u,required:!0}),e.jsx(w,{label:"Image URL (optional)",name:"image_url",value:i.image_url,onChange:u}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optional)"}),e.jsx("textarea",{name:"description",value:i.description,onChange:u,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Brief description of this category..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_active",checked:i.is_active,onChange:u,className:"mr-2"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Active (visible to customers)"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(d,{onClick:n?S:A,className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2",children:n?"Update Category":"Add Category"}),e.jsx(d,{onClick:$,variant:"outline",className:"px-6 py-2",children:"Cancel"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All Categories (",o.length,")"]})}),o.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Menu Items"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12",children:e.jsx("img",{className:"h-12 w-12 rounded-lg object-cover",src:t.image_url||`https://readdy.ai/api/search-image?query=delicious%20${t.name}%20food%20category&width=100&height=100&seq=${t.id}&orientation=square`,alt:t.name})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:t.description||"No description"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[t.food_items_count||0," items"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>D(t.id,t.is_active),className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{onClick:()=>E(t),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",children:[e.jsx("i",{className:"ri-edit-line mr-1"}),"Edit"]}),e.jsxs(d,{onClick:()=>q(t.id,t.name,t.food_items_count||0),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 text-sm",disabled:(t.food_items_count||0)>0,children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete"]})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-folder-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No categories found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first category to organize your menu items."}),e.jsx(d,{onClick:()=>h(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2",children:"Add First Category"})]})]})]})]})]})};export{O as default};
//# sourceMappingURL=page-CbRIr4sw.js.map
